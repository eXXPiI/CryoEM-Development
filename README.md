# CryoEM-Development
CryoEM image processing software development repository.

## Script Usage
Many of the scripts developed within this repository are intended to both speed up and improve the consistency of the processing of tomography datasets.
Some of the scripts are also intended to function as intermediates between emClarity and IMOD processing workflows.

### TiltAngleOrganizer Script
This script is intended to be used in a CLI. 
Navigate to the directory containing this file and open a terminal there. 
Then type "python TiltAngleOrganizer.py <Global/Path/To/Data> [1 or 0]." 
Here, the data path must end in a directory that contains ONLY a tilt series of MRC files. 
Multiple images of the same angle are okay as the script will search for and use the latest recorded image. 
Images must be named according to the SerialEM naming scheme. PNCC naming conventions are also valid. 
An example is "Base_GridNum_NavID_ImageNum_Angle_Date_Time.Extension" where Base, GridNum, and ImageNum are all optional. 
The optional input determines if the resulting organized MRC file based stack is opened in 3dmod. 
Without an optional argument, 3dmond is not opened. 
This script builds a sub-directory called "Tomo" where output files are generated.

### BinVolumeAutomator Script
This script is intended to be used in a CLI. 
Navigate to the directory containing this file and open a terminal there. 
Then type "python BinVolumeAutomator.py <Global/Path/To/Data> [Integer]." 
Here, the data path must end in a directory that contains the target tomogram reconstructions for binning. 
Other files may be present as they are automatically sorted out from the reconstructions based on the naming scheme from IMOD. 
The optional argument determines the uniform 3D binning parameter (e.g. 1 ==> 1X1X1 and 2 ==> 2X2X2). 
If the optional argument is not provided, the program defaults to a binning of 2 which reduces the image size by a factor of 8.

### RotateAutomator Script
This script is intended to be used in a CLI. 
Navigate to the directory containing this file and open a terminal there. 
Then type "python RotateAutomator.py <Global/Path/To/Data> [Float]." 
Here, the data path must end in a directory that contains partitioned target image stacks for rotation that are consistent with the structure as generated by the TiltAngleOrganizer Script (e.g. <DatasetHome/NavID/Tomo/tiltNavID.st>). 
Other files may be present as they are ignored based on the naming scheme consistent with emClarity. 
The optional argument determines the rotation angle in degrees that are consistent with the crossproduct (i.e. (+) ==> CCW and (-) ==> CW). 
If the optional argument is not provided, the program defaults to a rotation of 90 degrees.

### OrderUpdater Script
This script is intended to be used in a CLI. 
Navigate to the directory containing this file and open a terminal there. 
Then type "python OrderUpdater.py <Global/Path/To/Data>." 
Here, the data path must end in a directory that contains partitioned target image stacks for rotation that are consistent with the structure as generated by the TiltAngleOrganizer Script (e.g. <DatasetHome/NavID/Tomo/tiltNavID.st>). 
Other files may be present as they are ignored based on the naming scheme consistent with emClarity. 
This script then generates an .order file with the actual tomography angles for later use in emClarity image processing.

### FSCPlotter Script
This script is intended to be used in a CLI.
Navigate to the directory containing this file and open a terminal there.
Then type "python FSCPlotter.py <Global/Path/To/Data> <format>" where the format is generally either "png" or "pdf."
Here, the data path must end in a directory that contains the target FSC data file that is generated by emClarity (*_fsc_GLD.txt).
That file is read and others are ignored to produce a plot of the FSC curve.
The file is universally modular with the first column consisting of the spatial frequency components and the second column representing the FSC value.
Any additional columns are ignored but can easily be implemented into additional code.
An output file is generated and saved into the data directory.

### ParticleSummaryGenerator Script
This script is intended to be used in a CLI.
Navigate to the directory containing this file and open a terminal there.
Then type "python ParticleSummaryGenerator.py <Global/Path/To/Data/File> [Integer]."


## Code To Be Developed In Future
Some processes are worth developing into automated scripts but others sometimes are not.
These programs may be useful to standardize and speed up the generation of publication-grade graphics.

### Visualize Euler Angles From 3D Polar Plot
Generate polar plot of all particle angles to see angle distribution.
This may be accomplished within cryoSPARC or may be need to be developed.

### Visualize Particles From emClarity with IMOD
An average particle can be visualized on a tomogram using a few different tools.
emClarity generates a particle parameters file not unlike the motive list generated by PEET.
PEET (v1.15.x or later) generally writes Euler angles in the Z-X-Z' convention within the motive list.
emClarity particle Euler angles can be extracted from the convmap directory CSV file.
The most up-to-date particle angles are stored in the metadata MAT file.
PEET, along with other programs, should be able to read the modular particle summary file (CSV).
The summary file has a single header line consisting of "#contour,X,Y,Z,xAngle,yAngle,zAngle" which contains slicer (as opposed to Euler) angles.
Particle coordinates are directly copied into a new summary file that will be later used by PEET.
Particle Euler angles (within their own CSV) are then fed directly into the PEET MOTL2Slicer script.
The output slicer angles are then copied directly into the particle summary with the xAngles being negated.
The IMOD clonemodel script can then be used to project the model reconstruction directly onto the tomogram according to the particle summary.
To generate a binned particle that can be used for visualization in binned tomograms, it is best to use the rescale function within emClarity.

M02 End Program